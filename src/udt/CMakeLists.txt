FILE (GLOB udt_SOURCES "${CMAKE_CURRENT_SOURCE_DIR}/*.cpp")
FILE (GLOB udt_HEADERS "${CMAKE_CURRENT_SOURCE_DIR}/*.h")

IF (MSVC)
	CMAKE_POLICY(SET CMP0008 NEW)
        ADD_DEFINITIONS (-D__WIN32__)
        ADD_DEFINITIONS (-DNDEBUG)
ENDIF (MSVC)

ADD_LIBRARY (udt SHARED ${udt_SOURCES})
ADD_LIBRARY (udt_static STATIC ${udt_SOURCES})
SET_TARGET_PROPERTIES(udt_static PROPERTIES OUTPUT_NAME udt)

IF (WIN32)
	TARGET_LINK_LIBRARIES (udt Ws2_32.lib)
ENDIF (WIN32)
#TARGET_LINK_LIBRARIES (udt ${Boost_LIBRARIES})
#SET_TARGET_PROPERTIES (udt PROPERTIES VERSION 0.1 SOVERSION 0.1)

IF (MSVC)
	INSTALL (TARGETS udt udt_static
		RUNTIME DESTINATION bin
		LIBRARY DESTINATION bin
		ARCHIVE DESTINATION lib
		)
ELSE (MSVC)
	INSTALL	(TARGETS udt udt_static
		RUNTIME DESTINATION bin
		LIBRARY DESTINATION lib
		ARCHIVE DESTINATION lib
	)
ENDIF (MSVC)

IF(APPLE)
  SET_SOURCE_FILES_PROPERTIES(${udt_SOURCES} PROPERTIES COMPILE_FLAGS "-fPIC -w -DOSX -finline-functions -O3")
ELSEIF(UNIX AND NOT APPLE)
  SET_SOURCE_FILES_PROPERTIES(${udt_SOURCES} PROPERTIES COMPILE_FLAGS "-fPIC -w -pipe -DLINUX -finline-functions -O3")
ELSEIF(WIN32)
  IF(NOT MSVC)
    SET_TARGET_PROPERTIES(udt PROPERTIES COMPILE_FLAGS "-mthreads -w -finline-functions -O3 -D__MINGW__ -DWIN32 -D_WIN32_WINNT=0x0501")
    SET_TARGET_PROPERTIES(udt_static PROPERTIES COMPILE_FLAGS "-DDLL_EXPORTS  -mthreads -w -finline-functions -O3 -D__MINGW__ -DWIN32 -D_WIN32_WINNT=0x0501")
  ENDIF(NOT MSVC)
ENDIF(APPLE)

